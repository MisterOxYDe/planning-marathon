const planning = {
  // S51 : 15-21 décembre 2025
  "2025-12-15": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2025-12-16": {morning: "Course EF 50’", evening: "Vélo 1h15 + Haut du corps"},
  "2025-12-17": {morning: "Marche travail", evening: "Course piste 5×1000m"},
  "2025-12-18": {morning: "Marche travail", evening: "Vélo 1h15 + Jambes (force)"},
  "2025-12-19": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2025-12-20": {morning: "Repos / libre", evening: "Vélo 45–60’ facile (optionnel)"},
  "2025-12-21": {morning: "Sortie longue 1h30", evening: "Repos"},

  // S52 : 22-28 décembre 2025 (plus de course)
  "2025-12-22": {morning: "Marche travail", evening: "Course EF 55’"},
  "2025-12-23": {morning: "Course EF 55’", evening: "Vélo 1h + Haut du corps"},
  "2025-12-24": {morning: "Marche travail", evening: "Course piste 6×1000m"},
  "2025-12-25": {morning: "Marche travail", evening: "Course EF 40’ + Jambes (force)"},
  "2025-12-26": {morning: "Marche travail", evening: "Vélo 1h15 + Abdos"},
  "2025-12-27": {morning: "Repos / libre", evening: "Course EF 45’ facile (optionnel)"},
  "2025-12-28": {morning: "Sortie longue 1h40", evening: "Repos"},

  // S1 : 29 déc 2025 - 4 janv 2026
  "2025-12-29": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2025-12-30": {morning: "Course EF 55’", evening: "Vélo 1h15 + Haut du corps"},
  "2025-12-31": {morning: "Marche travail", evening: "Course piste 5×1200m"},
  "2026-01-01": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-01-02": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-01-03": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-01-04": {morning: "Sortie longue 1h45", evening: "Repos"},

  // S2 : 5 - 11 janvier 2026
  "2026-01-05": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-01-06": {morning: "Course EF 60’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-01-07": {morning: "Marche travail", evening: "Course piste 6×1200m"},
  "2026-01-08": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-01-09": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-01-10": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-01-11": {morning: "Sortie longue 1h50", evening: "Repos"},

  // S3 : 12 - 18 janvier 2026
  "2026-01-12": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-01-13": {morning: "Course EF 60’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-01-14": {morning: "Marche travail", evening: "Course piste 5×1500m"},
  "2026-01-15": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-01-16": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-01-17": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-01-18": {morning: "Sortie longue 1h55", evening: "Repos"},

  // S4 : 19 - 25 janvier 2026
  "2026-01-19": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-01-20": {morning: "Course EF 65’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-01-21": {morning: "Marche travail", evening: "Course piste 6×1500m"},
  "2026-01-22": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-01-23": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-01-24": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-01-25": {morning: "Sortie longue 2h", evening: "Repos"},

  // S5 : 26 janvier - 1 février 2026
  "2026-01-26": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-01-27": {morning: "Course EF 65’ ", evening: "Vélo 1h15 + Haut du corps"},
  "2026-01-28": {morning: "Marche travail", evening: "Course piste 6×1600m"},
  "2026-01-29": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-01-30": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-01-31": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-02-01": {morning: "Sortie longue 2h05", evening: "Repos"},

  // S6 : 2 - 8 février 2026
  "2026-02-02": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-02-03": {morning: "Course EF 70’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-02-04": {morning: "Marche travail", evening: "Course piste 5×1600m"},
  "2026-02-05": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-02-06": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-02-07": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-02-08": {morning: "Sortie longue 2h10", evening: "Repos"},

  // S7 : 9 - 15 février 2026
  "2026-02-09": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-02-10": {morning: "Course EF 70’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-02-11": {morning: "Marche travail", evening: "Course piste 6×1600m"},
  "2026-02-12": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-02-13": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-02-14": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-02-15": {morning: "Sortie longue 2h15", evening: "Repos"},

  // S8 : 16 - 22 février 2026
  "2026-02-16": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-02-17": {morning: "Course EF 75’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-02-18": {morning: "Marche travail", evening: "Course piste 5×2000m"},
  "2026-02-19": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-02-20": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-02-21": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-02-22": {morning: "Sortie longue 2h20", evening: "Repos"},

  // S9 : 23 - 29 février 2026
  "2026-02-23": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-02-24": {morning: "Course EF 75’ ", evening: "Vélo 1h15 + Haut du corps"},
  "2026-02-25": {morning: "Marche travail", evening: "Course piste 6×2000m"},
  "2026-02-26": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-02-27": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-02-28": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-02-29": {morning: "Sortie longue 2h25", evening: "Repos"},

  // S10 : 1 - 7 mars 2026
  "2026-03-01": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-03-02": {morning: "Course EF 80’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-03-03": {morning: "Marche travail", evening: "Course piste 5×2000m"},
  "2026-03-04": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-03-05": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-03-06": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-03-07": {morning: "Sortie longue 2h30", evening: "Repos"},

  // S11 : 8 - 14 mars 2026
  "2026-03-08": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-03-09": {morning: "Course EF 80’", evening: "Vélo 1h15 + Haut du corps"},
  "2026-03-10": {morning: "Marche travail", evening: "Course piste 6×2000m"},
  "2026-03-11": {morning: "Marche travail", evening: "Vélo 1h + Jambes (force)"},
  "2026-03-12": {morning: "Marche travail", evening: "Vélo 1h + Abdos"},
  "2026-03-13": {morning: "Repos / libre", evening: "Vélo 45’ facile (optionnel)"},
  "2026-03-14": {morning: "Sortie longue 2h30", evening: "Repos"},

  // S12 : 15 - 21 mars 2026 (début tapering)
  "2026-03-15": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-03-16": {morning: "Course EF 70’", evening: "Vélo 1h + Haut du corps"},
  "2026-03-17": {morning: "Marche travail", evening: "Course piste 4×1000m"},
  "2026-03-18": {morning: "Marche travail", evening: "Vélo 45’ + Jambes légères"},
  "2026-03-19": {morning: "Marche travail", evening: "Vélo 45’ + Abdos"},
  "2026-03-20": {morning: "Repos / libre", evening: "Repos"},
  "2026-03-21": {morning: "Sortie longue 1h30", evening: "Repos"},

  // S13 : 22 - 28 mars 2026 (tapering)
  "2026-03-22": {morning: "Marche travail", evening: "Vélo 30’ très doux"},
  "2026-03-23": {morning: "Course EF 50’ léger", evening: "Vélo 30’ très doux"},
  "2026-03-24": {morning: "Repos", evening: "Repos"},
  "2026-03-25": {morning: "Course EF 30’ léger", evening: "Repos"},
  "2026-03-26": {morning: "Repos", evening: "Repos"},
  "2026-03-27": {morning: "Repos", evening: "Repos"},
  "2026-03-28": {morning: "Repos", evening: "Repos"},

  // S14 : semaine marathon (29 mars - 5 avril 2026)
  "2026-03-29": {morning: "Repos", evening: "Repos"},
  "2026-03-30": {morning: "Repos", evening: "Repos"},
  "2026-03-31": {morning: "Repos", evening: "Repos"},
  "2026-04-01": {morning: "Repos", evening: "Repos"},
  "2026-04-02": {morning: "Repos", evening: "Repos"},
  "2026-04-03": {morning: "Repos", evening: "Repos"},
  "2026-04-04": {morning: "Repos", evening: "Repos"},
};

// Variables globales
let currentDate = new Date().toISOString().slice(0, 10);
let currentView = "day"; // "day", "week", "month"

// Utilitaires date
function formatDate(date) {
  return date.toISOString().slice(0, 10);
}

function formatDisplayDate(date) {
  return date.toLocaleDateString("fr-FR", { weekday: 'short', day: 'numeric', month: 'short' });
}

// Affiche séance d’un jour
function renderDay(dateStr) {
  const seance = planning[dateStr];
  const content = document.getElementById("content");
  content.innerHTML = `
    <div class="session">
      <h2>Planning du ${formatDisplayDate(new Date(dateStr))}</h2>
      <p><strong>Matin :</strong> ${seance?.morning || "<span class='noData'>Repos / Pas de données</span>"}</p>
      <p><strong>Soir :</strong> ${seance?.evening || "<span class='noData'>Repos / Pas de données</span>"}</p>
    </div>
  `;
}

// Affiche séance d’une semaine
function renderWeek(dateStr) {
  const content = document.getElementById("content");
  let date = new Date(dateStr);
  // Trouve lundi de la semaine
  const dayOfWeek = date.getDay();
  const diffToMonday = (dayOfWeek === 0) ? -6 : 1 - dayOfWeek;
  date.setDate(date.getDate() + diffToMonday);

  let html = `<h2>Planning semaine du ${formatDisplayDate(date)} au ${formatDisplayDate(new Date(date.getTime() + 6*24*60*60*1000))}</h2>`;
  html += `<table><thead><tr><th>Date</th><th>Matin</th><th>Soir</th></tr></thead><tbody>`;

  for(let i=0; i<7; i++) {
    const dStr = formatDate(date);
    const seance = planning[dStr];
    html += `<tr>
      <td class="dateCell">${formatDisplayDate(new Date(dStr))}</td>
      <td>${seance?.morning || "<span class='noData'>Repos / Pas de données</span>"}</td>
      <td>${seance?.evening || "<span class='noData'>Repos / Pas de données</span>"}</td>
    </tr>`;
    date.setDate(date.getDate() +1);
  }
  html += `</tbody></table>`;
  content.innerHTML = html;
}

// Affiche séance d’un mois
function renderMonth(dateStr) {
  const content = document.getElementById("content");
  let date = new Date(dateStr);
  const year = date.getFullYear();
  const month = date.getMonth();

  // Premier jour du mois
  let firstDay = new Date(year, month, 1);
  // Dernier jour du mois
  let lastDay = new Date(year, month +1, 0);

  let html = `<h2>Planning du mois de ${firstDay.toLocaleDateString("fr-FR", { month: 'long', year: 'numeric' })}</h2>`;
  html += `<table><thead><tr><th>Date</th><th>Matin</th><th>Soir</th></tr></thead><tbody>`;

  for(let d = firstDay; d <= lastDay; d.setDate(d.getDate()+1)) {
    const dStr = formatDate(d);
    const seance = planning[dStr];
    html += `<tr>
      <td class="dateCell">${formatDisplayDate(new Date(dStr))}</td>
      <td>${seance?.morning || "<span class='noData'>Repos / Pas de données</span>"}</td>
      <td>${seance?.evening || "<span class='noData'>Repos / Pas de données</span>"}</td>
    </tr>`;
  }

  html += `</tbody></table>`;
  content.innerHTML = html;
}

// Affiche selon la vue courante
function render() {
  switch(currentView) {
    case "day":
      renderDay(currentDate);
      break;
    case "week":
      renderWeek(currentDate);
      break;
    case "month":
      renderMonth(currentDate);
      break;
  }
}

// Navigation jours
document.getElementById("prevDay").addEventListener("click", () => {
  let d = new Date(currentDate);
  if(currentView === "day") d.setDate(d.getDate() - 1);
  else if(currentView === "week") d.setDate(d.getDate() - 7);
  else if(currentView === "month") d.setMonth(d.getMonth() -1);
  currentDate = formatDate(d);
  render();
});

document.getElementById("nextDay").addEventListener("click", () => {
  let d = new Date(currentDate);
  if(currentView === "day") d.setDate(d.getDate() + 1);
  else if(currentView === "week") d.setDate(d.getDate() + 7);
  else if(currentView === "month") d.setMonth(d.getMonth() +1);
  currentDate = formatDate(d);
  render();
});

// Changement de vue
document.getElementById("viewDay").addEventListener("click", () => {
  currentView = "day";
  render();
});
document.getElementById("viewWeek").addEventListener("click", () => {
  currentView = "week";
  render();
});
document.getElementById("viewMonth").addEventListener("click", () => {
  currentView = "month";
  render();
});

// Affichage initial
render();
